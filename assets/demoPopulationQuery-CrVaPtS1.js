import"./modulepreload-polyfill-B5Qt9EMX.js";const x="https://www.onemap.gov.sg/api",a=t=>document.getElementById(t),v=a("namesYear"),E=a("btnNames"),l=a("planningArea"),h=a("year"),$=a("gender"),w=a("metric"),A=a("btn"),p=a("err"),d=a("summary"),m=a("tableWrap"),g=a("raw"),u=a("btnCopy");function o(t){if(!t){p.classList.add("hidden"),p.textContent="";return}p.classList.remove("hidden"),p.textContent=t}function f(t){return String(t).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}async function b(t){const e=await fetch(t),n=await e.text().catch(()=>"");if(!e.ok)throw new Error(`${e.status} ${e.statusText}${n?` - ${n}`:""}`);return n?JSON.parse(n):{}}function C(t){const e=l.value||"Bedok";l.innerHTML="";for(const n of t){const r=document.createElement("option");r.value=n,r.textContent=n,l.appendChild(r)}t.includes(e)&&(l.value=e)}function N(t){if(!Array.isArray(t)||t.length===0){m.innerHTML='<div class="p-3 text-xs text-slate-600">无结果</div>';return}const e=Object.keys(t[0]||{}),n=t.slice(0,1),r=e.map(c=>`<th class="px-3 py-2">${f(c)}</th>`).join(""),i=n.map(c=>`<tr class="hover:bg-slate-50">${e.map(s=>`<td class="px-3 py-2 font-mono">${f((c==null?void 0:c[s])??"")}</td>`).join("")}</tr>`).join("");m.innerHTML=`
          <table class="min-w-full text-left text-xs">
            <thead class="bg-slate-50 text-slate-600"><tr>${r}</tr></thead>
            <tbody class="divide-y divide-slate-100">${i}</tbody>
          </table>
          <div class="px-3 py-2 text-[11px] text-slate-500">仅展示第一行（方便 copy/paste），完整内容请看 Raw JSON</div>
        `}E.addEventListener("click",async()=>{o(null);const t=parseInt((v.value||"").trim(),10);if(!Number.isFinite(t)||t<=0)return o("Names year 必须是正整数");try{const e=`${x}/public/popapi/getPlanningareaNames?year=${encodeURIComponent(t)}`,n=await b(e),r=Array.isArray(n)?n.map(i=>String(i).trim()).filter(Boolean):[];r.length>0&&C(r)}catch(e){o((e==null?void 0:e.message)||"加载 planning areas 失败")}});A.addEventListener("click",async()=>{o(null),u.disabled=!0,d.textContent="请求中…",m.innerHTML="",g.textContent="";const t=(l.value||"").trim(),e=parseInt((h.value||"").trim(),10),n=($.value||"").trim(),r=w.value;if(!t)return o("planningArea 不能为空");if(!Number.isFinite(e)||e<=0)return o("year 必须是正整数");if(!n)return o("gender 不能为空");const i=r==="economic"?"getEconomicStatus":r==="age"?"getPopulationAgeGroup":null;if(!i)return o("未知 metric");const c=`${x}/public/popapi/${i}?planningArea=${encodeURIComponent(t)}&year=${encodeURIComponent(e)}&gender=${encodeURIComponent(n)}`;try{const s=await b(c);g.textContent=JSON.stringify(s,null,2),u.disabled=!1,u.onclick=async()=>navigator.clipboard.writeText(JSON.stringify(s,null,2));const y=Array.isArray(s)?s:[];d.textContent=`rows=${y.length} • endpoint=${i}`,N(y)}catch(s){o((s==null?void 0:s.message)||"请求失败"),d.textContent="等待请求…"}});
